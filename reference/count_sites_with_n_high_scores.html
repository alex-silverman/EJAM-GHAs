<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Answers questions like how many sites have certain indicators &gt;2x the state avg? — count_sites_with_n_high_scores • EJAM</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Answers questions like how many sites have certain indicators &gt;2x the state avg? — count_sites_with_n_high_scores"><meta name="description" content="This function provides tables of summary stats but also text
that explains those findings in plain English. It relies on colcounter_summary_all()"><meta property="og:description" content="This function provides tables of summary stats but also text
that explains those findings in plain English. It relies on colcounter_summary_all()"><meta property="og:image" content="https://usepa.github.io/EJAM/logo.svg"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">EJAM</a>

    <small class="nav-text text-warning me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">2.32.2</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Overview for EJAM Users</h6></li>
    <li><a class="dropdown-item" href="../articles/0_whatis.html">What is EJAM?</a></li>
    <li><a class="dropdown-item" href="../articles/0_webapp.html">Accessing the Web App</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>For analysts using R</h6></li>
    <li><a class="dropdown-item" href="../articles/1_installing.html">Installing the EJAM R package</a></li>
    <li><a class="dropdown-item" href="../articles/2_quickstart.html">Quick Start Guide</a></li>
    <li><a class="dropdown-item" href="../articles/3_analyzing.html">Using EJAM for Analysis in R</a></li>
    <li><a class="dropdown-item" href="../articles/4_advanced.html">Advanced Features</a></li>
    <li><a class="dropdown-item" href="../articles/zipcodes.html">Zipcodes</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.svg" class="logo" alt=""><h1>Answers questions like how many sites have certain indicators &gt;2x the state avg?</h1>
      <small class="dont-index">Source: <a href="https://github.com/USEPA/EJAM-open/blob/v2.32.2/R/count_sites_with_n_high_scores.R" class="external-link"><code>R/count_sites_with_n_high_scores.R</code></a></small>
      <div class="d-none name"><code>count_sites_with_n_high_scores.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>This function provides tables of summary stats but also text
that explains those findings in plain English. It relies on <code><a href="colcounter_summary_all.html">colcounter_summary_all()</a></code></p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">count_sites_with_n_high_scores</span><span class="op">(</span></span>
<span>  <span class="va">scores</span>,</span>
<span>  thresholds <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  indicator_type <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"percentile"</span>, <span class="st">"ratio"</span>, <span class="st">"other"</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>,</span>
<span>  xwide <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">""</span>, <span class="st">"statewide"</span>, <span class="st">"nationwide"</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>,</span>
<span>  site_stat_type <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"cum_pct"</span>, <span class="st">"cum_count"</span>, <span class="st">"pct"</span>, <span class="st">"count"</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>,</span>
<span>  text_suffix <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"th percentile"</span>, <span class="st">" times the average"</span>, <span class="st">""</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/match.html" class="external-link">match</a></span><span class="op">(</span><span class="va">indicator_type</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"percentile"</span>, <span class="st">"ratio"</span>, <span class="st">"other"</span><span class="op">)</span><span class="op">)</span><span class="op">]</span>,</span>
<span>  text_indicatortype <span class="op">=</span> <span class="st">"indicators"</span>,</span>
<span>  quiet <span class="op">=</span> <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/interactive.html" class="external-link">interactive</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-scores">scores<a class="anchor" aria-label="anchor" href="#arg-scores"></a></dt>
<dd><p>scores in a table with one row per place and one column per indicator</p></dd>


<dt id="arg-thresholds">thresholds<a class="anchor" aria-label="anchor" href="#arg-thresholds"></a></dt>
<dd><p>thresholds vector of numbers as benchmarks. Assuming the indicators
in the scores table are ratios to the average, then the thresholds could be
for example, 1.50, 2, etc. which would represent ratios that are 1.5x or 2x etc.</p></dd>


<dt id="arg-indicator-type">indicator_type<a class="anchor" aria-label="anchor" href="#arg-indicator-type"></a></dt>
<dd><p>Scores and benchmarks are percentiles, ratios,
or anything else. One of these: c("percentile", "ratio", "other")</p></dd>


<dt id="arg-xwide">xwide<a class="anchor" aria-label="anchor" href="#arg-xwide"></a></dt>
<dd><p>must be "statewide" or "nationwide" – used only in the text output
that describes the findings.</p></dd>


<dt id="arg-site-stat-type">site_stat_type<a class="anchor" aria-label="anchor" href="#arg-site-stat-type"></a></dt>
<dd><p>Count or share of sites, exactly or cumulatively.
One of these: c("cum_pct", "cum_count", "pct", "count")</p></dd>


<dt id="arg-text-suffix">text_suffix<a class="anchor" aria-label="anchor" href="#arg-text-suffix"></a></dt>
<dd><p>If using ratios, use the default, which explains these
thresholds as X times the average.
If using percentiles as thresholds, set text_suffix = "."
or text_suffix = "th percentile in the state." for example</p></dd>


<dt id="arg-text-indicatortype">text_indicatortype<a class="anchor" aria-label="anchor" href="#arg-text-indicatortype"></a></dt>
<dd><p>can be "Summary Indexes" etc.</p></dd>


<dt id="arg-quiet">quiet<a class="anchor" aria-label="anchor" href="#arg-quiet"></a></dt>
<dd><p>whether to print findings to console</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>Returns a list with two named elements, "stats" and "text" where
stats is a 3-dimensional array of numbers. See dimnames(output$stats).</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>Helps provide stat summaries such as:</p>
<p>(x%) of these (sites) have</p>
<p>at least (N) of these (YTYPE )indicators</p>
<p>at least (R) times the (State/National average)</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># out &lt;- ejamit(testpoints_100, radius = 1)</span></span></span>
<span class="r-in"><span><span class="va">out</span> <span class="op">&lt;-</span> <span class="va">testoutput_ejamit_1000pts_1miles</span> </span></span>
<span class="r-in"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="va">out</span><span class="op">$</span><span class="va">results_bysite</span></span></span>
<span class="r-in"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu">setDF</span><span class="op">(</span><span class="fu">copy</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error in setDF(copy(x)):</span> could not find function "setDF"</span>
<span class="r-in"><span><span class="va">ratio_data</span> <span class="op">&lt;-</span> <span class="va">x</span><span class="op">[</span>, <span class="va">names_d_ratio_to_state_avg</span><span class="op">]</span></span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error in `[.data.table`(x, , names_d_ratio_to_state_avg):</span> j (the 2nd argument inside [...]) is a single symbol but column name 'names_d_ratio_to_state_avg' is not found. If you intended to select columns using a variable in calling scope, please try DT[, ..names_d_ratio_to_state_avg]. The .. prefix conveys one-level-up similar to a file system path.</span>
<span class="r-in"><span><span class="va">ratio_benchmarks</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">3</span>, <span class="fl">5</span>, <span class="fl">10</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">findings</span> <span class="op">&lt;-</span> <span class="fu">count_sites_with_n_high_scores</span><span class="op">(</span><span class="va">ratio_data</span>, <span class="va">ratio_benchmarks</span><span class="op">)</span></span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error:</span> object 'ratio_data' not found</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">findings</span><span class="op">)</span></span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error:</span> object 'findings' not found</span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">findings</span><span class="op">$</span><span class="va">text</span><span class="op">)</span></span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error:</span> object 'findings' not found</span>
<span class="r-in"><span><span class="co">#   see most striking stat only</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">tail</a></span><span class="op">(</span><span class="va">findings</span><span class="op">$</span><span class="va">text</span><span class="op">[</span><span class="va">findings</span><span class="op">$</span><span class="va">text</span> <span class="op">!=</span> <span class="st">""</span><span class="op">]</span>, <span class="fl">1</span><span class="op">)</span> <span class="co"># the most extreme finding</span></span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error:</span> object 'findings' not found</span>
<span class="r-in"><span><span class="va">findings</span><span class="op">$</span><span class="va">text</span><span class="op">[</span><span class="va">findings</span><span class="op">$</span><span class="va">text</span> <span class="op">!=</span> <span class="st">""</span><span class="op">]</span></span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error:</span> object 'findings' not found</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/dimnames.html" class="external-link">dimnames</a></span><span class="op">(</span><span class="va">findings</span><span class="op">$</span><span class="va">stats</span><span class="op">)</span> <span class="co"># count, cut, stat</span></span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error:</span> object 'findings' not found</span>
<span class="r-in"><span><span class="co">## stat can be count, cum, pct, or cum_pct</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">findings</span><span class="op">$</span><span class="va">stats</span><span class="op">[</span><span class="fl">1</span>,,<span class="op">]</span> <span class="co"># any of the indicators (at least one indicator)</span></span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error:</span> object 'findings' not found</span>
<span class="r-in"><span><span class="va">findings</span><span class="op">$</span><span class="va">stats</span><span class="op">[</span>,,<span class="st">"count"</span><span class="op">]</span></span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error:</span> object 'findings' not found</span>
<span class="r-in"><span><span class="va">findings</span><span class="op">$</span><span class="va">stats</span><span class="op">[</span> , , <span class="fl">1</span><span class="op">]</span></span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error:</span> object 'findings' not found</span>
<span class="r-in"><span><span class="va">findings</span><span class="op">$</span><span class="va">stats</span><span class="op">[</span> , <span class="fl">1</span>, <span class="op">]</span></span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error:</span> object 'findings' not found</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">pctile_data</span> <span class="op">&lt;-</span> <span class="va">testoutput_ejamit_1000pts_1miles</span><span class="op">$</span><span class="va">results_bysite</span></span></span>
<span class="r-in"><span><span class="va">pctile_data</span> <span class="op">&lt;-</span> <span class="va">pctile_data</span><span class="op">[</span>, <span class="va">..names_ej_state_pctile</span><span class="op">]</span></span></span>
<span class="r-in"><span><span class="va">pctile_benchmarks</span> <span class="op">&lt;-</span> <span class="fl">90</span></span></span>
<span class="r-in"><span><span class="va">y</span> <span class="op">&lt;-</span> <span class="fu">count_sites_with_n_high_scores</span><span class="op">(</span><span class="va">pctile_data</span>, <span class="va">pctile_benchmarks</span>,</span></span>
<span class="r-in"><span>  indicator_type <span class="op">=</span> <span class="st">"percentile"</span>,</span></span>
<span class="r-in"><span>  text_indicatortype <span class="op">=</span> <span class="st">"Summary Indexes"</span>, xwide <span class="op">=</span> <span class="st">"statewide"</span> </span></span>
<span class="r-in"><span>  <span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># At how many sites is at least one of these indicators at least 90th pctile nationwide?</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="fu"><a href="rowMaxs2.html">rowMaxs2</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="va">pctile_data</span><span class="op">)</span><span class="op">)</span> <span class="op">&gt;=</span> <span class="fl">90</span>, na.rm <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error in rowMaxs2(data.frame(pctile_data)):</span> could not find function "rowMaxs2"</span>
<span class="r-in"><span><span class="co">## or </span></span></span>
<span class="r-in"><span><span class="fu">count_sites_with_n_high_scores</span><span class="op">(</span><span class="va">pctile_data</span>, <span class="fl">90</span>, xwide <span class="op">=</span> <span class="st">"nationwide"</span>, quiet <span class="op">=</span> <span class="cn">T</span><span class="op">)</span><span class="op">$</span><span class="va">stats</span><span class="op">[</span>count <span class="op">=</span> <span class="st">"1"</span>, cut <span class="op">=</span> <span class="st">"90"</span>, stat <span class="op">=</span> <span class="st">"cum"</span><span class="op">]</span> </span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 268</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># see most striking stat only</span></span></span>
<span class="r-in"><span><span class="va">mx</span> <span class="op">&lt;-</span> <span class="fu">count_sites_with_n_high_scores</span><span class="op">(</span><span class="va">pctile_data</span>, </span></span>
<span class="r-in"><span>  thresholds <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">100</span>, quiet <span class="op">=</span> <span class="cn">TRUE</span>,</span></span>
<span class="r-in"><span>  text_indicatortype <span class="op">=</span> <span class="st">"Summary Indexes"</span>,</span></span>
<span class="r-in"><span>  text_suffix <span class="op">=</span> <span class="st">"th percentile in the state."</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">tail</a></span><span class="op">(</span><span class="va">mx</span><span class="op">$</span><span class="va">text</span><span class="op">[</span><span class="va">mx</span><span class="op">$</span><span class="va">text</span> <span class="op">!=</span> <span class="st">""</span><span class="op">]</span>, <span class="fl">1</span><span class="op">)</span> <span class="co"># the most extreme finding</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "At at least 1% of these sites, 2 of the Summary Indexes are 99th percentile in the state. "</span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>US EPA 2025</p>
</div>

<div class="pkgdown-footer-right">
  <p>EJAM Version 2.32.2</p>
</div>

    </footer></div>





  </body></html>

