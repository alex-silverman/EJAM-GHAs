<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>For user-provided indicators and formulas, aggregate at each site and overall — doaggregate_newscores • EJAM</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="For user-provided indicators and formulas, aggregate at each site and overall — doaggregate_newscores"><meta name="description" content="Like doaggregate() but for any user-provided indicator available for all
block groups (nationwide so that US percentiles make sense, or at least statewide)"><meta property="og:description" content="Like doaggregate() but for any user-provided indicator available for all
block groups (nationwide so that US percentiles make sense, or at least statewide)"><meta property="og:image" content="https://usepa.github.io/EJAM/logo.svg"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">EJAM</a>

    <small class="nav-text text-warning me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">2.32.2</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Overview for EJAM Users</h6></li>
    <li><a class="dropdown-item" href="../articles/0_whatis.html">What is EJAM?</a></li>
    <li><a class="dropdown-item" href="../articles/0_webapp.html">Accessing the Web App</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>For analysts using R</h6></li>
    <li><a class="dropdown-item" href="../articles/1_installing.html">Installing the EJAM R package</a></li>
    <li><a class="dropdown-item" href="../articles/2_quickstart.html">Quick Start Guide</a></li>
    <li><a class="dropdown-item" href="../articles/3_analyzing.html">Using EJAM for Analysis in R</a></li>
    <li><a class="dropdown-item" href="../articles/4_advanced.html">Advanced Features</a></li>
    <li><a class="dropdown-item" href="../articles/zipcodes.html">Zipcodes</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.svg" class="logo" alt=""><h1>For user-provided indicators and formulas, aggregate at each site and overall</h1>
      <small class="dont-index">Source: <a href="https://github.com/USEPA/EJAM/blob/HEAD/R/PROXIMITY_FUNCTIONS.R" class="external-link"><code>R/PROXIMITY_FUNCTIONS.R</code></a></small>
      <div class="d-none name"><code>doaggregate_newscores.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Like doaggregate() but for any user-provided indicator available for all
block groups (nationwide so that US percentiles make sense, or at least statewide)</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">doaggregate_newscores</span><span class="op">(</span></span>
<span>  <span class="va">sites2blocks</span>,</span>
<span>  <span class="va">userstats</span>,</span>
<span>  formulas <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  sites2states_or_latlon <span class="op">=</span> <span class="cn">NA</span>,</span>
<span>  radius <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  countcols <span class="op">=</span> <span class="st">"pop"</span>,</span>
<span>  popmeancols <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  calculatedcols <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  varsneedpctiles <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  usastats_newscores <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  statestats_newscores <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-sites-blocks">sites2blocks<a class="anchor" aria-label="anchor" href="#arg-sites-blocks"></a></dt>
<dd><p>output of <code><a href="getblocksnearby.html">getblocksnearby()</a></code>, as for <code><a href="doaggregate.html">doaggregate()</a></code></p></dd>


<dt id="arg-userstats">userstats<a class="anchor" aria-label="anchor" href="#arg-userstats"></a></dt>
<dd><p>like blockgroupstats but data.frame or data.table of all US
blockgroups and one or more columns of user provided raw indicator scores
and any other variables needed for formulas to aggregate indicators
across block groups in each site.</p></dd>


<dt id="arg-formulas">formulas<a class="anchor" aria-label="anchor" href="#arg-formulas"></a></dt>
<dd><p>a character vector of formulas in R code (see formulas_d for
an example), that use variables in userstats to calculate any
derived indicators or aggregated ones, for cases where just a sum or a
population weighted mean is not the right way to aggregate some indicator.
Formulas can include intermediate steps, or can aggregate across all places.</p>
<p>For example one formula might be</p>
<p>"pctover64 = ifelse(pop == 0, 0, over64 / pop)"</p></dd>


<dt id="arg-sites-states-or-latlon">sites2states_or_latlon<a class="anchor" aria-label="anchor" href="#arg-sites-states-or-latlon"></a></dt>
<dd><p>see <code><a href="doaggregate.html">doaggregate()</a></code></p></dd>


<dt id="arg-radius">radius<a class="anchor" aria-label="anchor" href="#arg-radius"></a></dt>
<dd><p>see <code><a href="doaggregate.html">doaggregate()</a></code></p></dd>


<dt id="arg-countcols">countcols<a class="anchor" aria-label="anchor" href="#arg-countcols"></a></dt>
<dd><p>see <code><a href="doaggregate.html">doaggregate()</a></code></p></dd>


<dt id="arg-popmeancols">popmeancols<a class="anchor" aria-label="anchor" href="#arg-popmeancols"></a></dt>
<dd><p>see <code><a href="doaggregate.html">doaggregate()</a></code></p></dd>


<dt id="arg-calculatedcols">calculatedcols<a class="anchor" aria-label="anchor" href="#arg-calculatedcols"></a></dt>
<dd><p>see <code><a href="doaggregate.html">doaggregate()</a></code></p></dd>


<dt id="arg-varsneedpctiles">varsneedpctiles<a class="anchor" aria-label="anchor" href="#arg-varsneedpctiles"></a></dt>
<dd><p>see <code><a href="doaggregate.html">doaggregate()</a></code></p></dd>


<dt id="arg-usastats-newscores">usastats_newscores<a class="anchor" aria-label="anchor" href="#arg-usastats-newscores"></a></dt>
<dd><p>calculated if not provided</p></dd>


<dt id="arg-statestats-newscores">statestats_newscores<a class="anchor" aria-label="anchor" href="#arg-statestats-newscores"></a></dt>
<dd><p>calculated if not provided</p></dd>


<dt id="arg--">...<a class="anchor" aria-label="anchor" href="#arg--"></a></dt>
<dd><p>not used</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>see <code><a href="doaggregate.html">doaggregate()</a></code></p>
    </div>

  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>US EPA 2025</p>
</div>

<div class="pkgdown-footer-right">
  <p>EJAM Version 2.32.2</p>
</div>

    </footer></div>





  </body></html>

